import { extract, token_set_ratio } from "fuzzball";

export const getFuzzyWebCachedResponse = (query: string): string | null => {
  const match = extract(query, Object.keys(cachedWebSearchResponses), {
    scorer: token_set_ratio,
    returnObjects: true,
    limit: 1,
  })[0];

  if (match && match.score > 65) {
    // return cached response if match score > 65%
    return match.choice;
  }

  return null;
};

export const getExactDatasetCachedResponse = (
  query: string
):
  | (typeof cachedFinancialDatasetResponses)[keyof typeof cachedFinancialDatasetResponses]
  | null => {
  const match = Object.keys(cachedFinancialDatasetResponses).find(
    (key) => key === query
  );

  if (match) {
    // return cached response if an exact match is found
    return cachedFinancialDatasetResponses[
      match as keyof typeof cachedFinancialDatasetResponses
    ];
  }

  return null;
};

const cachedWebSearchResponses = {
  "Apple revenue trends 2020-2024 analysis iPhone services product lines performance":
    {
      answer:
        "Apple's revenue and earnings are forecast to grow, with revenue expected to increase by 5.4% annually and earnings by 8.4% per annum ([Simply Wall St](https://simplywall.st/stocks/us/tech/nasdaq-aapl/apple/future)). Apple's Q2 2025 results showed revenue of $95.4 billion USD and earnings per share of $1.65 USD, driven by strong sales of iPhone, iPad, and Mac ([RoboForex Ltd](https://roboforex.com/beginners/analytics/forex-forecast/stocks/stocks-forecast-apple-aapl-2025)). However, iPhone sales faced a decline in the first half of 2024, with revenue dropping by $2.7 billion year-over-year ([girolino.com](https://www.girolino.com/apples-revenue-challenges-declining-iphone-sales-and-antitrust-lawsuit)). Despite this, Apple's overall revenue grew, and the company is focusing on AI integration and hardware development, with plans to launch new iPhone and iPad models in 2025 ([wire.insiderfinance.io](https://wire.insiderfinance.io/the-future-prospects-of-apple-inc-aapl-a-comprehensive-analysis-173ece2ad851)).\n",
      citations: [
        {
          text: "The Future Prospects of Apple Inc. (AAPL): A Comprehensive Analysis",
        },
        { text: "Apple's Revenue Challenges: Analysis and Outlook" },
        {
          text: "Apple (NasdaqGS:AAPL) Stock Forecast & Analyst Predictions - Simply Wall St",
        },
        {
          text: "Apple Inc. (AAPL) stock analysis and forecast for 2025 - RoboForex",
        },
        {
          text: "Apple (AAPL) Revenue Slowdown Might Impact Its EPS. Yet Still A Buy",
        },
        {
          text: "Financial statement analysis and revenue forecast for Apple Inc.",
        },
        {
          text: "Apple Inc. (AAPL): Financial Analysis and Strategic Moves in 2025",
        },
      ],
    },
  "Tesla net profit 2024 2025 financial perfomance analysis stock price impact":
    {
      answer:
        "Tesla's financial performance and stock price trajectory are subject to various factors, including market dynamics, technological advancements, and competition. Here's a breakdown of what to expect as of today, July 15, 2025:\n\n*   **Financial Performance:** Tesla's revenue is projected to increase significantly in 2025, potentially reaching $127.61 billion, driven by increased vehicle deliveries, the adoption of Full Self-Driving (FSD) technology, and the expansion of energy solutions. ([Accessories for Tesla](https://www.accessoriesfortesla.com/post/understanding-the-future-of-tesla-stock-insights-and-predictions-for-2025)) Analysts predict earnings per share (EPS) to climb to $3.87, a 37.08% increase from the previous year, reflecting operational efficiencies and strategic initiatives. ([Accessories for Tesla](https://www.accessoriesfortesla.com/post/understanding-the-future-of-tesla-stock-insights-and-predictions-for-2025)) Tesla's GAAP net income rose 20% to approximately $15 billion in 2023. ([Medium](https://medium.com/@nambos3rd/tesla-full-year-2023-analysis-a-review-of-actual-performance-my-financial-forecast-579771d7d452))\n*   **Stock Price Impact:** Analysts have mixed predictions for Tesla's stock in 2025. Some see it climbing due to innovation and expansion plans, while others are more cautious. Mid-year 2025 projections range from a most bullish projection of $555.41 to a most bearish projection of $216.27. End-of-year 2025 projections range from a most bullish projection of $786.21 to a most bearish projection of $218.90. ([Accessories for Tesla](https://www.accessoriesfortesla.com/post/understanding-the-future-of-tesla-stock-insights-and-predictions-for-2025))\n*   **Key Factors:** Tesla's growth will be influenced by advancements in AI and autonomous driving, with analysts optimistic about these technologies. ([OpenTools.ai](https://opentools.ai/news/teslas-q4-2024-delivery-numbers-set-to-break-records-amidst-optimistic-future-projections)) The company is also focusing on cost-cutting and enhanced factory utilization. ([Accessories for Tesla](https://www.accessoriesfortesla.com/post/understanding-the-future-of-tesla-stock-insights-and-predictions-for-2025))\n*   **Competition:** Tesla faces competition from Chinese EV manufacturers like NIO and BYD, which offer competitive pricing and innovation. ([Accessories for Tesla](https://www.accessoriesfortesla.com/post/understanding-the-future-of-tesla-stock-insights-and-predictions-for-2025))\n*   **Deliveries:** Tesla is expected to report record-breaking Q4 2024 delivery numbers, with analysts projecting over 515,000 units. ([OpenTools.ai](https://opentools.ai/news/teslas-q4-2024-delivery-numbers-set-to-break-records-amidst-optimistic-future-projections))\n",
      citations: [
        {
          text: "Tesla Full Year 2023 Analysis — A Review of Actual Performance & My Financial Forecast | by Abdulmajid B. Isah | Medium",
        },
        {
          text: "Understanding the Future of Tesla Stock: Insights and Predictions for 2025",
        },
        {
          text: "Tesla's Q4 2024 Delivery Numbers Set to Break Records Amidst Optimistic Future Projections",
        },
        {
          text: "Tesla’s Q3 2024 Earnings: Innovation and Expansion in the Age of Sustainable Energy",
        },
        {
          text: "Tesla’s revenue forecast base on business model and financial statement analysis",
        },
        {
          text: "Tesla Valuation Report 2024: Short-Term Growth Pains or A Busted Growth Story? | by Abdulmajid B. Isah | Medium",
        },
        { text: "(PDF) Tesla Financial Performance Forecast and Analysis" },
      ],
    },
  "Nvidia revenue growth 2020-2025 AI boom data center gaming factors": {
    answer:
      "Nvidia's revenue growth from 2020 to 2025 has been substantial, driven by the AI boom, data center expansion, and the gaming market.\n\n*   **Revenue Growth:** Nvidia's revenue increased fivefold from fiscal year 2019 to fiscal year 2024, reaching $60.9 billion ([The Motley Fool](https://www.fool.com/investing/2024/07/05/where-will-nvidia-stock-be-in-5-years)). Analysts forecast continued growth, with the potential for revenue to triple in just three fiscal years from fiscal year 2024 levels ([The Motley Fool](https://www.fool.com/investing/2024/07/05/where-will-nvidia-stock-be-in-5-years)). Simply Wall St. forecasts revenue of $199.885 billion for the fiscal year ending January 31, 2026, and $251.196 billion for the fiscal year ending January 31, 2027 ([Simply Wall St](https://simplywall.st/stocks/us/semiconductors/nasdaq-nvda/nvidia/future)).\n*   **AI and Data Center:** Mizuho Securities projects Nvidia's data center revenue to reach $89 billion in fiscal year 2025 and $280 billion in 2027 ([The Motley Fool](https://www.fool.com/investing/2024/07/05/where-will-nvidia-stock-be-in-5-years)). The AI chip market is expected to reach $400 billion in annual revenue in 2027 ([The Motley Fool](https://www.fool.com/investing/2024/07/05/where-will-nvidia-stock-be-in-5-years)).\n*   **Gaming:** The gaming hardware market is projected to grow to $241 billion by 2029, with Nvidia holding a significant market share in PC graphics cards ([The Motley Fool](https://www.fool.com/investing/2024/07/05/where-will-nvidia-stock-be-in-5-years)).\n",
    citations: [
      { text: "Where Will Nvidia Stock Be in 5 Years?" },
      {
        text: "NVIDIA (NasdaqGS:NVDA) Stock Forecast & Analyst Predictions  - Simply Wall St",
      },
      {
        text: "Prediction: Nvidia's Revenue Will Soar in 2025, but 2026 Will Be a Wild Card",
      },
      {
        text: "NVIDIA (NASDAQ: NVDA) Price Prediction and Forecast 2025-2030 for July 8",
      },
      { text: "Nvidia is set for remarkable growth and innovation." },
      { text: "NVDA Market Outlook" },
      { text: "Where Will Nvidia Stock Be in 3 Years?" },
      {
        text: "NVIDIA's future hinges on $400b revenue and AI software dominance",
      },
    ],
  },
};

const cachedFinancialDatasetResponses = {
  '{"ticker": "AAPL", "period": "annual", "limit": 5}': [
    {
      ticker: "AAPL",
      report_period: "2024-09-28",
      fiscal_period: "2024-FY",
      period: "annual",
      currency: "USD",
      revenue: 391035000000,
      cost_of_revenue: 210352000000,
      gross_profit: 180683000000,
      operating_expense: 57467000000,
      selling_general_and_administrative_expenses: 26097000000,
      research_and_development: 31370000000,
      operating_income: 123216000000,
      interest_expense: 0,
      ebit: 123485000000,
      income_tax_expense: 29749000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 93736000000,
      net_income_common_stock: 93736000000,
      preferred_dividends_impact: 0,
      consolidated_income: 93736000000,
      earnings_per_share: 6.11,
      earnings_per_share_diluted: 6.08,
      dividends_per_common_share: 0.98,
      weighted_average_shares: 15343783000,
      weighted_average_shares_diluted: 15408095000,
    },
    {
      ticker: "AAPL",
      report_period: "2023-09-30",
      fiscal_period: "2023-FY",
      period: "annual",
      currency: "USD",
      revenue: 383285000000,
      cost_of_revenue: 214137000000,
      gross_profit: 169148000000,
      operating_expense: 54847000000,
      selling_general_and_administrative_expenses: 24932000000,
      research_and_development: 29915000000,
      operating_income: 114301000000,
      interest_expense: 0,
      ebit: 113736000000,
      income_tax_expense: 16741000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 96995000000,
      net_income_common_stock: 96995000000,
      preferred_dividends_impact: 0,
      consolidated_income: 96995000000,
      earnings_per_share: 6.16,
      earnings_per_share_diluted: 6.13,
      dividends_per_common_share: 0.94,
      weighted_average_shares: 15744231000,
      weighted_average_shares_diluted: 15812547000,
    },
    {
      ticker: "AAPL",
      report_period: "2022-09-24",
      fiscal_period: "2022-FY",
      period: "annual",
      currency: "USD",
      revenue: 394328000000,
      cost_of_revenue: 223546000000,
      gross_profit: 170782000000,
      operating_expense: 51345000000,
      selling_general_and_administrative_expenses: 25094000000,
      research_and_development: 26251000000,
      operating_income: 119437000000,
      interest_expense: 0,
      ebit: 119103000000,
      income_tax_expense: 19300000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 99803000000,
      net_income_common_stock: 99803000000,
      preferred_dividends_impact: 0,
      consolidated_income: 99803000000,
      earnings_per_share: 6.15,
      earnings_per_share_diluted: 6.11,
      dividends_per_common_share: 0.9,
      weighted_average_shares: 16215963000,
      weighted_average_shares_diluted: 16325819000,
    },
    {
      ticker: "AAPL",
      report_period: "2021-09-25",
      fiscal_period: "2021-FY",
      period: "annual",
      currency: "USD",
      revenue: 365817000000,
      cost_of_revenue: 212981000000,
      gross_profit: 152836000000,
      operating_expense: 43887000000,
      selling_general_and_administrative_expenses: 21973000000,
      research_and_development: 21914000000,
      operating_income: 108949000000,
      interest_expense: 2645000000,
      ebit: 111852000000,
      income_tax_expense: 14527000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 94680000000,
      net_income_common_stock: 94680000000,
      preferred_dividends_impact: 0,
      consolidated_income: 94680000000,
      earnings_per_share: 5.67,
      earnings_per_share_diluted: 5.61,
      dividends_per_common_share: 0.85,
      weighted_average_shares: 16701272000,
      weighted_average_shares_diluted: 16864919000,
    },
    {
      ticker: "AAPL",
      report_period: "2020-09-26",
      fiscal_period: "2020-FY",
      period: "annual",
      currency: "USD",
      revenue: 274515000000,
      cost_of_revenue: 169559000000,
      gross_profit: 104956000000,
      operating_expense: 38668000000,
      selling_general_and_administrative_expenses: 19916000000,
      research_and_development: 18752000000,
      operating_income: 66288000000,
      interest_expense: 2873000000,
      ebit: 69964000000,
      income_tax_expense: 9680000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 57411000000,
      net_income_common_stock: 57411000000,
      preferred_dividends_impact: 0,
      consolidated_income: 57411000000,
      earnings_per_share: 3.31,
      earnings_per_share_diluted: 3.28,
      dividends_per_common_share: 0.795,
      weighted_average_shares: 17352119000,
      weighted_average_shares_diluted: 17528214000,
    },
  ],
  '{"ticker": "TSLA", "period": "quarterly", "limit": 4}': [
    {
      ticker: "TSLA",
      report_period: "2025-03-31",
      fiscal_period: "2025-Q1",
      period: "quarterly",
      currency: "USD",
      revenue: 19335000000,
      cost_of_revenue: 16182000000,
      gross_profit: 3153000000,
      operating_expense: 2754000000,
      selling_general_and_administrative_expenses: 1251000000,
      research_and_development: 1409000000,
      operating_income: 399000000,
      interest_expense: 91000000,
      ebit: 669000000,
      income_tax_expense: 169000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 11000000,
      net_income: 409000000,
      net_income_common_stock: 409000000,
      preferred_dividends_impact: 0,
      consolidated_income: 420000000,
      earnings_per_share: 0.13,
      earnings_per_share_diluted: 0.12,
      dividends_per_common_share: 0,
      weighted_average_shares: 3218000000,
      weighted_average_shares_diluted: 3218000000,
    },
    {
      ticker: "TSLA",
      report_period: "2024-12-31",
      fiscal_period: "2024-Q4",
      period: "quarterly",
      currency: "USD",
      revenue: 25707000000,
      cost_of_revenue: 21528000000,
      gross_profit: 4179000000,
      operating_expense: 2596000000,
      selling_general_and_administrative_expenses: 1313000000,
      research_and_development: 1276000000,
      operating_income: 1583000000,
      interest_expense: 96000000,
      ebit: 2847000000,
      income_tax_expense: 434000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 15000000,
      net_income: 2317000000,
      net_income_common_stock: 2317000000,
      preferred_dividends_impact: 0,
      consolidated_income: 2332000000,
      earnings_per_share: 0.72,
      earnings_per_share_diluted: 0.66,
      dividends_per_common_share: 0,
      weighted_average_shares: 3212000000,
      weighted_average_shares_diluted: 3212000000,
    },
    {
      ticker: "TSLA",
      report_period: "2024-09-30",
      fiscal_period: "2024-Q3",
      period: "quarterly",
      currency: "USD",
      revenue: 25182000000,
      cost_of_revenue: 20185000000,
      gross_profit: 4997000000,
      operating_expense: 2280000000,
      selling_general_and_administrative_expenses: 1186000000,
      research_and_development: 1039000000,
      operating_income: 2717000000,
      interest_expense: 92000000,
      ebit: 2860000000,
      income_tax_expense: 601000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 16000000,
      net_income: 2167000000,
      net_income_common_stock: 2167000000,
      preferred_dividends_impact: 0,
      consolidated_income: 2183000000,
      earnings_per_share: 0.68,
      earnings_per_share_diluted: 0.62,
      dividends_per_common_share: 0,
      weighted_average_shares: 3198000000,
      weighted_average_shares_diluted: 3198000000,
    },
    {
      ticker: "TSLA",
      report_period: "2024-06-30",
      fiscal_period: "2024-Q2",
      period: "quarterly",
      currency: "USD",
      revenue: 25500000000,
      cost_of_revenue: 20922000000,
      gross_profit: 4578000000,
      operating_expense: 2973000000,
      selling_general_and_administrative_expenses: 1277000000,
      research_and_development: 1074000000,
      operating_income: 1605000000,
      interest_expense: 86000000,
      ebit: 1957000000,
      income_tax_expense: 393000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 16000000,
      net_income: 1478000000,
      net_income_common_stock: 1478000000,
      preferred_dividends_impact: 0,
      consolidated_income: 1494000000,
      earnings_per_share: 0.46,
      earnings_per_share_diluted: 0.42,
      dividends_per_common_share: 0,
      weighted_average_shares: 3191000000,
      weighted_average_shares_diluted: 3191000000,
    },
  ],
  '{"ticker": "NVDA", "period": "annual", "limit": 5}': [
    {
      ticker: "NVDA",
      report_period: "2025-01-26",
      fiscal_period: "2025-FY",
      period: "annual",
      currency: "USD",
      revenue: 130497000000,
      cost_of_revenue: 32639000000,
      gross_profit: 97858000000,
      operating_expense: 16405000000,
      selling_general_and_administrative_expenses: 3491000000,
      research_and_development: 12914000000,
      operating_income: 81453000000,
      interest_expense: 247000000,
      ebit: 84273000000,
      income_tax_expense: 11146000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 72880000000,
      net_income_common_stock: 72880000000,
      preferred_dividends_impact: 0,
      consolidated_income: 72880000000,
      earnings_per_share: 2.97,
      earnings_per_share_diluted: 2.94,
      dividends_per_common_share: 0.034,
      weighted_average_shares: 24555000000,
      weighted_average_shares_diluted: 24804000000,
    },
    {
      ticker: "NVDA",
      report_period: "2024-01-28",
      fiscal_period: "2024-FY",
      period: "annual",
      currency: "USD",
      revenue: 60922000000,
      cost_of_revenue: 16621000000,
      gross_profit: 44301000000,
      operating_expense: 11329000000,
      selling_general_and_administrative_expenses: 2654000000,
      research_and_development: 8675000000,
      operating_income: 32972000000,
      interest_expense: 257000000,
      ebit: 34075000000,
      income_tax_expense: 4058000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 29760000000,
      net_income_common_stock: 29760000000,
      preferred_dividends_impact: 0,
      consolidated_income: 29760000000,
      earnings_per_share: 1.21,
      earnings_per_share_diluted: 1.19,
      dividends_per_common_share: 0.016,
      weighted_average_shares: 24690000000,
      weighted_average_shares_diluted: 24940000000,
    },
    {
      ticker: "NVDA",
      report_period: "2023-01-29",
      fiscal_period: "2023-FY",
      period: "annual",
      currency: "USD",
      revenue: 26974000000,
      cost_of_revenue: 11618000000,
      gross_profit: 15356000000,
      operating_expense: 11132000000,
      selling_general_and_administrative_expenses: 2440000000,
      research_and_development: 7339000000,
      operating_income: 4224000000,
      interest_expense: 262000000,
      ebit: 4443000000,
      income_tax_expense: -187000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 4368000000,
      net_income_common_stock: 4368000000,
      preferred_dividends_impact: 0,
      consolidated_income: 4368000000,
      earnings_per_share: 0.18,
      earnings_per_share_diluted: 0.17,
      dividends_per_common_share: 0.016,
      weighted_average_shares: 24870000000,
      weighted_average_shares_diluted: 25070000000,
    },
    {
      ticker: "NVDA",
      report_period: "2022-01-30",
      fiscal_period: "2022-FY",
      period: "annual",
      currency: "USD",
      revenue: 26914000000,
      cost_of_revenue: 9439000000,
      gross_profit: 17475000000,
      operating_expense: 7434000000,
      selling_general_and_administrative_expenses: 2166000000,
      research_and_development: 5268000000,
      operating_income: 10041000000,
      interest_expense: 236000000,
      ebit: 10177000000,
      income_tax_expense: 189000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 9752000000,
      net_income_common_stock: 9752000000,
      preferred_dividends_impact: 0,
      consolidated_income: 9752000000,
      earnings_per_share: 0.391,
      earnings_per_share_diluted: 0.385,
      dividends_per_common_share: 0.016,
      weighted_average_shares: 24960000000,
      weighted_average_shares_diluted: 25350000000,
    },
    {
      ticker: "NVDA",
      report_period: "2021-01-31",
      fiscal_period: "2021-FY",
      period: "annual",
      currency: "USD",
      revenue: 16675000000,
      cost_of_revenue: 6279000000,
      gross_profit: 10396000000,
      operating_expense: 5864000000,
      selling_general_and_administrative_expenses: 1940000000,
      research_and_development: 3924000000,
      operating_income: 4532000000,
      interest_expense: 184000000,
      ebit: 4593000000,
      income_tax_expense: 77000000,
      net_income_discontinued_operations: 0,
      net_income_non_controlling_interests: 0,
      net_income: 4332000000,
      net_income_common_stock: 4332000000,
      preferred_dividends_impact: 0,
      consolidated_income: 4332000000,
      earnings_per_share: 0.176,
      earnings_per_share_diluted: 0.173,
      dividends_per_common_share: 0.016,
      weighted_average_shares: 24670000000,
      weighted_average_shares_diluted: 25100000000,
    },
  ],
};
